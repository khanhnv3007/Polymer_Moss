<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/font-roboto/roboto.html">
<link rel="import" href="bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="bower_components/core-icons/core-icons.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="bower_components/core-localstorage/core-localstorage.html">
<link rel="import" href="bower_components/core-item/core-item.html">
<link rel="import" href="bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-slider/paper-slider.html">
<link rel="import" href="bower_components/paper-toast/paper-toast.html">
<link rel="import" href="bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="bower_components/core-splitter/core-splitter.html">
<link rel="import" href="bower_components/polymer-ui-toggle-button/polymer-ui-toggle-button.html">
<polymer-element name="moss-app">
  <template>
  <link rel="stylesheet" href="styles.css">
  <core-drawer-panel responsiveWidth="600px" id="drawerPanel" narrow="{{narrow}}">

    <core-header-panel drawer mode="waterfall">
      <core-toolbar class="{{ {tall : !narrow} | tokenList }}">Language</core-toolbar>
        <paper-radio-group>
          <paper-radio-button label="C"></paper-radio-button><br>
          <paper-radio-button label="C++"></paper-radio-button><br>
          <paper-radio-button label="Java"></paper-radio-button><br>
          <paper-radio-button label="javaScript"></paper-radio-button><br>
          <paper-radio-button label="Python"></paper-radio-button><br>
          <paper-radio-button label="C#"></paper-radio-button><br>
          <paper-radio-button label="PHP"></paper-radio-button><br>
          <paper-radio-button label="Objective-C"></paper-radio-button><br>
          <paper-radio-button label="Perl"></paper-radio-button><br>
          <paper-radio-button label="Matlab"></paper-radio-button><br>
          <paper-radio-button label="TCL"></paper-radio-button><br>
        </paper-radio-group>
    </core-header-panel>

    <core-header-panel main mode="waterfall">
      <core-toolbar class="{{ {tall : !narrow} | tokenList }}">
        <paper-icon-button icon="menu" on-click="{{toggleDrawer}}"></paper-icon-button>
        <span flex>Check Code</span>
      </core-toolbar>
        <div id="dropzone" on-tap="{{tapSelect}}"
          on-dragover="{{handleDragOver}}"
          on-drop="{{handleFileSelect}}">
          Drag files to upload
          <input type="file" id="files" name="files[]"
          on-change="{{handleFilePick}}" multiple>
      </div>
    </core-header-panel>
  </core-drawer-panel>
</template>
<script>
  Polymer('moss-app', {
    uploadList: [],    // selected files
    uploadedList: [],  // successfully uploaded files
    autoUpload: false, // automatically upload?

    tapSelect: function (e) {
        this.$.files.click();
    },

    handleDragOver: function (e) {
        e.stopPropagation();
        e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';
    },

    handleFilePick: function (e) {
        e.stopPropagation();
        e.preventDefault();
        this.selectFiles(e.target.files);
    },

    handleFileSelect: function (e) {
        e.stopPropagation();
        e.preventDefault();
        this.selectFiles(e.dataTransfer.files);
    },

    clearUploadList: function () {
        this.uploadedList = [];
        this.uploadList = [];
    },
    uploadFiles: function (files) {
      var uploadedList = this.uploadedList;
      this.$.status.innerHTML = 'Uploading...';

      var f;
      for(var i=0; f = files[i]; i++) {
        var uploader = new MediaUploader({
          file: f,
          token: this.accessToken,
          onComplete: function (data) {
            uploadedList.push(JSON.parse(data));
            this.$.status.innerHTML = 'Upload successful';
            this.uploadList = [];
          }.bind(this)
        });
        uploader.upload();
      }
    },

    manualUpload: function () {
      this.uploadFiles(this.queue);
    },

    selectFiles: function (files) {
      this.queue = files;
      //this.$.status.textContent = 'Files selected';

      var f;
      for(var i=0; f = files[i]; i++) {
        this.uploadList.push(f);
      }

      if(this.autoUpload) {
        this.uploadFiles(files);
      }
    },
    signedIn: function (e) {
      this.accessToken = e.detail.result.access_token;
      this.$.loggedin.style.display = 'block';
    },

    signedOut: function (e) {
      this.$.loggedin.style.display = 'hidden';

    }
  });
</script>
</polymer-element>